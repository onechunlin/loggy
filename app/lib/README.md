# æœåŠ¡å±‚æ¶æ„è¯´æ˜

## ğŸ“ ç›®å½•ç»“æ„

```
app/lib/
â”œâ”€â”€ server/          # æœåŠ¡ç«¯æœåŠ¡ï¼ˆBFF å±‚ï¼‰
â”‚   â”œâ”€â”€ openai-service.ts    # DeepSeek API æœåŠ¡
â”‚   â””â”€â”€ index.ts             # ç»Ÿä¸€å¯¼å‡º
â””â”€â”€ client/          # å®¢æˆ·ç«¯æœåŠ¡ï¼ˆå‰ç«¯ UI å±‚ï¼‰
    â”œâ”€â”€ ai-agent.ts          # AI Agent æœåŠ¡
    â”œâ”€â”€ message-storage.ts   # æ¶ˆæ¯å­˜å‚¨æœåŠ¡
    â”œâ”€â”€ note-storage.ts      # ç¬”è®°å­˜å‚¨æœåŠ¡
    â”œâ”€â”€ todo-storage.ts      # å¾…åŠå­˜å‚¨æœåŠ¡
    â””â”€â”€ index.ts             # ç»Ÿä¸€å¯¼å‡º
```

## ğŸ—ï¸ æ¶æ„è¯´æ˜

### æœåŠ¡ç«¯æœåŠ¡ (`lib/server/`)

**è¿è¡Œç¯å¢ƒï¼š** Node.jsï¼ˆæœåŠ¡ç«¯ / BFF å±‚ï¼‰

**ç‰¹ç‚¹ï¼š**
- ä½¿ç”¨ `process.env` è®¿é—®ç¯å¢ƒå˜é‡
- ç›´æ¥è°ƒç”¨ç¬¬ä¸‰æ–¹ APIï¼ˆå¦‚ DeepSeek APIï¼‰
- åªè¢« `app/api/` ä¸‹çš„è·¯ç”±å¯¼å…¥
- ä¸ä¼šè¢«æ‰“åŒ…åˆ°å®¢æˆ·ç«¯

**æ–‡ä»¶ï¼š**
- `openai-service.ts` - DeepSeek API æœåŠ¡ï¼Œå¤„ç†æµå¼å’Œéæµå¼å“åº”

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```typescript
// åœ¨ app/api/chat/route.ts ä¸­
import { streamChat, chat } from "@/app/lib/server";
```

### å®¢æˆ·ç«¯æœåŠ¡ (`lib/client/`)

**è¿è¡Œç¯å¢ƒï¼š** æµè§ˆå™¨ï¼ˆå‰ç«¯ UI å±‚ï¼‰

**ç‰¹ç‚¹ï¼š**
- ä½¿ç”¨æµè§ˆå™¨ APIï¼ˆå¦‚ `fetch`, `localforage`ï¼‰
- é€šè¿‡ HTTP è¯·æ±‚è°ƒç”¨æœåŠ¡ç«¯ API
- è¢«å®¢æˆ·ç«¯ç»„ä»¶å¯¼å…¥ï¼ˆæœ‰ `"use client"` æŒ‡ä»¤ï¼‰
- ä¼šè¢«æ‰“åŒ…åˆ°å®¢æˆ·ç«¯

**æ–‡ä»¶ï¼š**
- `ai-agent.ts` - AI Agent æœåŠ¡ï¼Œå¤„ç†å·¥å…·è°ƒç”¨é€»è¾‘
- `*-storage.ts` - æœ¬åœ°å­˜å‚¨æœåŠ¡ï¼Œä½¿ç”¨ IndexedDB

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```typescript
// åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­
import { aiAgentService } from "@/app/lib/client";
import { saveMessages, loadMessages } from "@/app/lib/client";
```

## ğŸ”„ æ•°æ®æµå‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯ç»„ä»¶ (components/)               â”‚
â”‚   â””â”€> lib/client/ai-agent.ts            â”‚
â”‚       â””â”€> fetch('/api/chat')             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“ HTTP è¯·æ±‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API è·¯ç”± (api/chat/route.ts)          â”‚
â”‚   â””â”€> lib/server/openai-service.ts      â”‚
â”‚       â””â”€> DeepSeek API                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ è¿ç§»è¯´æ˜

æ—§çš„ `app/services/` ç›®å½•å·²åºŸå¼ƒï¼Œä½†ä¸ºäº†å‘åå…¼å®¹ï¼Œ`services/index.ts` ä¼šé‡æ–°å¯¼å‡º `lib/server` å’Œ `lib/client`ã€‚

**å»ºè®®ï¼š** æ–°ä»£ç è¯·ç›´æ¥ä½¿ç”¨ `@/app/lib/server` æˆ– `@/app/lib/client`ã€‚

